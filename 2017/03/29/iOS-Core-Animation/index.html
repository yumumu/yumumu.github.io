<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="CALayer的一些重要属性 contents contestGravity (UView-contentMode) contentsScale masksToBounds (UIView-clipsToBounds) contentsRect (The default contentsRect is {0, 0, 1, 1}, 代表整个backing image是可见的)，如果设置成{0, 0,">
<meta name="keywords" content="Animation">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS Core Animation">
<meta property="og:url" content="http://yoursite.com/2017/03/29/iOS-Core-Animation/index.html">
<meta property="og:site_name" content="于木木的笔记">
<meta property="og:description" content="CALayer的一些重要属性 contents contestGravity (UView-contentMode) contentsScale masksToBounds (UIView-clipsToBounds) contentsRect (The default contentsRect is {0, 0, 1, 1}, 代表整个backing image是可见的)，如果设置成{0, 0,">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-04-18T12:34:59.066Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS Core Animation">
<meta name="twitter:description" content="CALayer的一些重要属性 contents contestGravity (UView-contentMode) contentsScale masksToBounds (UIView-clipsToBounds) contentsRect (The default contentsRect is {0, 0, 1, 1}, 代表整个backing image是可见的)，如果设置成{0, 0,">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>iOS Core Animation</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/03/30/Instruments学习记录/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017/03/19/行为型设计模式/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/03/29/iOS-Core-Animation/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&text=iOS Core Animation"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&is_video=false&description=iOS Core Animation"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=iOS Core Animation&body=Check out this article: http://yoursite.com/2017/03/29/iOS-Core-Animation/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&name=iOS Core Animation&description=&lt;h3 id=&quot;CALayer的一些重要属性&quot;&gt;&lt;a href=&quot;#CALayer的一些重要属性&quot; class=&quot;headerlink&quot; title=&quot;CALayer的一些重要属性&quot;&gt;&lt;/a&gt;CALayer的一些重要属性&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;contents&lt;/li&gt;
&lt;li&gt;contestGravity (UView-contentMode)&lt;/li&gt;
&lt;li&gt;contentsScale&lt;/li&gt;
&lt;li&gt;masksToBounds (UIView-clipsToBounds)&lt;/li&gt;
&lt;li&gt;contentsRect (The default contentsRect is {0, 0, 1, 1}, 代表整个backing image是可见的)，如果设置成{0, 0, 0.5, 0.5}，就变成左上角四分之一是可见的。（与CSS中的雪碧图概念类似），我们可以把一张图片设置成contents,然后再修改contentsRect属性，达到只使用一部分图片的效果。&lt;/li&gt;
&lt;li&gt;contentsCenter这个名字乍看上去具有误导性，它的默认值是{0, 0, 1, 1},这代表我们缩放图片的时候，整个图片的区域都会被缩放，如果我们修改contentCenter的值，就可以达到修改缩放区域的目的。聊天类的应用中该属性应该比较常用，比如聊天气泡。&lt;/li&gt;&lt;/ul&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2017/03/29/iOS-Core-Animation/&t=iOS Core Animation"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#CALayer的一些重要属性"><span class="toc-number">1.</span> <span class="toc-text">CALayer的一些重要属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layer-Geometry"><span class="toc-number">2.</span> <span class="toc-text">Layer Geometry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Visual-Effects"><span class="toc-number">3.</span> <span class="toc-text">Visual Effects</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Rounded-Corners"><span class="toc-number">3.1.</span> <span class="toc-text">Rounded Corners</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Layer-Borders"><span class="toc-number">3.2.</span> <span class="toc-text">Layer Borders</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Drop-Shadows"><span class="toc-number">3.3.</span> <span class="toc-text">Drop Shadows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Shadow-Clipping"><span class="toc-number">3.4.</span> <span class="toc-text">Shadow Clipping</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layer-Masking"><span class="toc-number">4.</span> <span class="toc-text">Layer Masking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scaling-Filters"><span class="toc-number">5.</span> <span class="toc-text">Scaling Filters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Group-Opacity"><span class="toc-number">6.</span> <span class="toc-text">Group Opacity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transforms"><span class="toc-number">7.</span> <span class="toc-text">Transforms</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Affine-Transforms"><span class="toc-number">7.1.</span> <span class="toc-text">Affine Transforms</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Shear-Transform"><span class="toc-number">7.2.</span> <span class="toc-text">The Shear Transform</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3D-Transforms"><span class="toc-number">8.</span> <span class="toc-text">3D Transforms</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Vanishing-Point"><span class="toc-number">8.1.</span> <span class="toc-text">The Vanishing Point</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-sublayerTransform-Property"><span class="toc-number">8.2.</span> <span class="toc-text">The sublayerTransform Property</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layer-Flattening"><span class="toc-number">9.</span> <span class="toc-text">Layer Flattening</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solid-Objects"><span class="toc-number">10.</span> <span class="toc-text">Solid Objects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Light-and-Shadow"><span class="toc-number">11.</span> <span class="toc-text">Light and Shadow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Specialized-Layers"><span class="toc-number">12.</span> <span class="toc-text">Specialized Layers</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CAShapeLayer"><span class="toc-number">12.1.</span> <span class="toc-text">CAShapeLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#除了使用CAShapeLayer绘制圆角，UIBezierPath提供了分别控制矩形圆角大小的能力"><span class="toc-number">12.2.</span> <span class="toc-text">除了使用CAShapeLayer绘制圆角，UIBezierPath提供了分别控制矩形圆角大小的能力</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CATextLayer"><span class="toc-number">12.3.</span> <span class="toc-text">CATextLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CATransformLayer"><span class="toc-number">12.4.</span> <span class="toc-text">CATransformLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAGradientLayer"><span class="toc-number">12.5.</span> <span class="toc-text">CAGradientLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAReplicatorLayer"><span class="toc-number">12.6.</span> <span class="toc-text">CAReplicatorLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAScrollLayer"><span class="toc-number">12.7.</span> <span class="toc-text">CAScrollLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CATiledLayer"><span class="toc-number">12.8.</span> <span class="toc-text">CATiledLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAEmitterLayer"><span class="toc-number">12.9.</span> <span class="toc-text">CAEmitterLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAEAGLLayer"><span class="toc-number">12.10.</span> <span class="toc-text">CAEAGLLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AVPlayerLayer-属于AVfoundation-不属于Core-Animation"><span class="toc-number">12.11.</span> <span class="toc-text">AVPlayerLayer  属于AVfoundation,不属于Core Animation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implict-Animations"><span class="toc-number">13.</span> <span class="toc-text">Implict Animations</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Transactions"><span class="toc-number">13.1.</span> <span class="toc-text">Transactions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Completion-Block"><span class="toc-number">13.2.</span> <span class="toc-text">Completion Block</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Layer-Actions"><span class="toc-number">13.3.</span> <span class="toc-text">Layer Actions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Presentation-Versus-Model"><span class="toc-number">13.4.</span> <span class="toc-text">Presentation Versus Model</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Explict-Animations"><span class="toc-number">14.</span> <span class="toc-text">Explict Animations</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Property-Animations"><span class="toc-number">14.1.</span> <span class="toc-text">Property Animations</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Basic-Animations"><span class="toc-number">14.1.1.</span> <span class="toc-text">Basic Animations</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CAAmimationDelegate"><span class="toc-number">14.1.2.</span> <span class="toc-text">CAAmimationDelegate</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyframe-Animations"><span class="toc-number">14.2.</span> <span class="toc-text">Keyframe Animations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Virtual-Properties"><span class="toc-number">14.3.</span> <span class="toc-text">Virtual Properties</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Animation-Groups"><span class="toc-number">15.</span> <span class="toc-text">Animation Groups</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transitions"><span class="toc-number">16.</span> <span class="toc-text">Transitions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Implicit-Transitions"><span class="toc-number">16.1.</span> <span class="toc-text">Implicit Transitions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Animating-Layer-Tree-Changes"><span class="toc-number">16.2.</span> <span class="toc-text">Animating Layer Tree Changes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Custom-Transitions"><span class="toc-number">16.3.</span> <span class="toc-text">Custom Transitions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Canceling-an-Animation-in-Progress"><span class="toc-number">17.</span> <span class="toc-text">Canceling an Animation in Progress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layer-Time"><span class="toc-number">18.</span> <span class="toc-text">Layer Time</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-CAMediaTiming-Protocol"><span class="toc-number">18.1.</span> <span class="toc-text">The CAMediaTiming Protocol</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Duartion-and-Repetition"><span class="toc-number">18.2.</span> <span class="toc-text">Duartion and Repetition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Relative-Time"><span class="toc-number">18.3.</span> <span class="toc-text">Relative Time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fillMode"><span class="toc-number">18.4.</span> <span class="toc-text">fillMode</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hierarchical-Time"><span class="toc-number">19.</span> <span class="toc-text">Hierarchical Time</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Global-Versus-Local-Time"><span class="toc-number">19.1.</span> <span class="toc-text">Global Versus Local Time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pause-Rewind-and-Fast-Forward"><span class="toc-number">19.2.</span> <span class="toc-text">Pause, Rewind, and Fast-Forward</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Manual-Animation"><span class="toc-number">20.</span> <span class="toc-text">Manual Animation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Easing"><span class="toc-number"></span> <span class="toc-text">Easing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Animation-Velocity"><span class="toc-number">1.</span> <span class="toc-text">Animation Velocity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAMediaTimingFunction"><span class="toc-number">2.</span> <span class="toc-text">CAMediaTimingFunction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Easing-and-KeyFrame-Animations"><span class="toc-number">3.</span> <span class="toc-text">Easing and KeyFrame Animations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Easing-Functions"><span class="toc-number">4.</span> <span class="toc-text">Custom Easing Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyframe-Based-Easing"><span class="toc-number">4.1.</span> <span class="toc-text">Keyframe-Based Easing</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Timer-Based-Animation"><span class="toc-number">5.</span> <span class="toc-text">Timer-Based Animation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Frame-Timeing"><span class="toc-number">5.1.</span> <span class="toc-text">Frame Timeing</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#NSTimer"><span class="toc-number">5.1.1.</span> <span class="toc-text">NSTimer</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CADisplayLink"><span class="toc-number">5.2.</span> <span class="toc-text">CADisplayLink</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mesauring-Frame-Duration"><span class="toc-number">5.3.</span> <span class="toc-text">Mesauring Frame Duration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Run-Loop-Modes"><span class="toc-number">5.4.</span> <span class="toc-text">Run Loop Modes</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Physical-Simulation"><span class="toc-number">6.</span> <span class="toc-text">Physical Simulation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Chipmunk"><span class="toc-number">6.1.</span> <span class="toc-text">Chipmunk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GPU-Bound-Opearions"><span class="toc-number">6.2.</span> <span class="toc-text">GPU-Bound Opearions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CPU-Bound-Operations"><span class="toc-number">6.3.</span> <span class="toc-text">CPU-Bound Operations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IO-Bound-Operations"><span class="toc-number">6.4.</span> <span class="toc-text">IO-Bound Operations</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Measure，Don’t-Guess"><span class="toc-number">7.</span> <span class="toc-text">Measure，Don’t Guess</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-Reality-Not-a-Simulation"><span class="toc-number">7.1.</span> <span class="toc-text">Test Reality, Not a Simulation</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Efficent-Drawing"><span class="toc-number"></span> <span class="toc-text">Efficent Drawing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Software-Drawing"><span class="toc-number">1.</span> <span class="toc-text">Software Drawing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vector-Graphics"><span class="toc-number">2.</span> <span class="toc-text">Vector Graphics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Asynchronous-Drawing"><span class="toc-number">3.</span> <span class="toc-text">Asynchronous Drawing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CATailedLayer"><span class="toc-number">3.1.</span> <span class="toc-text">CATailedLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#drawsAsynchronously"><span class="toc-number">3.2.</span> <span class="toc-text">drawsAsynchronously</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Image-IO"><span class="toc-number"></span> <span class="toc-text">Image IO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Loading-and-Latency"><span class="toc-number">1.</span> <span class="toc-text">Loading and Latency</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thread-Loading"><span class="toc-number">2.</span> <span class="toc-text">Thread Loading</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCD-and-NSOperationQueue"><span class="toc-number">3.</span> <span class="toc-text">GCD and NSOperationQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deferred-Decompression"><span class="toc-number">4.</span> <span class="toc-text">Deferred Decompression</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CATailedLayer-1"><span class="toc-number">5.</span> <span class="toc-text">CATailedLayer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Caching"><span class="toc-number">6.</span> <span class="toc-text">Caching</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-imageNamed-Method"><span class="toc-number">6.1.</span> <span class="toc-text">The +imageNamed: Method</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Caching"><span class="toc-number">7.</span> <span class="toc-text">Custom Caching</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NSCache"><span class="toc-number">7.1.</span> <span class="toc-text">NSCache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hybrid-Images"><span class="toc-number">7.2.</span> <span class="toc-text">Hybrid Images</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JPEG2000"><span class="toc-number">7.3.</span> <span class="toc-text">JPEG2000</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PVRTC"><span class="toc-number">7.4.</span> <span class="toc-text">PVRTC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Layer-Performance"><span class="toc-number"></span> <span class="toc-text">Layer Performance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Inexplicit-Drawing"><span class="toc-number">1.</span> <span class="toc-text">Inexplicit Drawing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Text"><span class="toc-number">1.1.</span> <span class="toc-text">Text</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Rasterization"><span class="toc-number">1.2.</span> <span class="toc-text">Rasterization</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Offscreen-Rendering"><span class="toc-number">1.3.</span> <span class="toc-text">Offscreen Rendering</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAShapeLayer-1"><span class="toc-number">1.4.</span> <span class="toc-text">CAShapeLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stretchable-Images"><span class="toc-number">1.5.</span> <span class="toc-text">Stretchable Images</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shadowPath"><span class="toc-number">1.6.</span> <span class="toc-text">shadowPath</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blending-and-Overdraw"><span class="toc-number">2.</span> <span class="toc-text">Blending and Overdraw</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reducing-Layer-Count"><span class="toc-number">3.</span> <span class="toc-text">Reducing Layer Count</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        iOS Core Animation
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">于木木的笔记</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2017-03-29T11:14:30.000Z" itemprop="datePublished">2017-03-29</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Animation/">Animation</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="CALayer的一些重要属性"><a href="#CALayer的一些重要属性" class="headerlink" title="CALayer的一些重要属性"></a>CALayer的一些重要属性</h3><ul>
<li>contents</li>
<li>contestGravity (UView-contentMode)</li>
<li>contentsScale</li>
<li>masksToBounds (UIView-clipsToBounds)</li>
<li>contentsRect (The default contentsRect is {0, 0, 1, 1}, 代表整个backing image是可见的)，如果设置成{0, 0, 0.5, 0.5}，就变成左上角四分之一是可见的。（与CSS中的雪碧图概念类似），我们可以把一张图片设置成contents,然后再修改contentsRect属性，达到只使用一部分图片的效果。</li>
<li>contentsCenter这个名字乍看上去具有误导性，它的默认值是{0, 0, 1, 1},这代表我们缩放图片的时候，整个图片的区域都会被缩放，如果我们修改contentCenter的值，就可以达到修改缩放区域的目的。聊天类的应用中该属性应该比较常用，比如聊天气泡。<a id="more"></a>
设置backing image有两种方式。<br>一种是设置layer的contents属性，另一种方式是使用-drawRect:。<br>-drawRect:方法默认没有实现，因为UIView不要求一个custom backing image。<blockquote>
<p>If you don’t need this backing image, it’s a waste of memory and CPU time to create it, which is why Apple recommends that you don’t leave an empty -drawRect: method in your layer subclasses if you don’t intend to do any custom drawing.</p>
</blockquote>
</li>
</ul>
<h3 id="Layer-Geometry"><a href="#Layer-Geometry" class="headerlink" title="Layer Geometry"></a>Layer Geometry</h3><ul>
<li>frame<blockquote>
<p>The frame is not really a distinct property of the view or layer at all; it is a virtual property, computed from the bounds, position, and transform, and therefore changes when any of those properties are modified. Conversely, changing the frame may affect any or all of those values, as well.<br>(当对一个view进行transform的时候，bounds的宽高不一定和frame的宽高相等)</p>
</blockquote>
</li>
<li>bounds</li>
<li>position</li>
<li>anchorPoint (想象用图钉把一张纸钉在墙上，钉子所在的点就是anchorPoint, position是anchorPoint所在的位置)<blockquote>
<p>The anchorPoint can be placed outside of the layer bounds by specifying x or y values that are less than zero or greater than one.</p>
</blockquote>
</li>
<li>zPosition</li>
<li>anchorPointZ (可以用该属性改变layer之间的展示顺序)</li>
</ul>
<h3 id="Visual-Effects"><a href="#Visual-Effects" class="headerlink" title="Visual Effects"></a>Visual Effects</h3><h4 id="Rounded-Corners"><a href="#Rounded-Corners" class="headerlink" title="Rounded Corners"></a>Rounded Corners</h4><ul>
<li>cornerRadius (默认情况下，该属性只会对CALayer的background color 起作用，the backing image or sublayers 不会受影响。如果我们把masksToBounds设置为YES, layer中的所有元素都会被切成圆角)<h4 id="Layer-Borders"><a href="#Layer-Borders" class="headerlink" title="Layer Borders"></a>Layer Borders</h4></li>
<li>borderWidth</li>
<li>borderColor<br>二者定义了一条被绘制在layer边上的线。该线条被绘制在layer bounds 内部，在layer中其它所有内容包括sublayers前面,（可以理解成border的zPostion值大一些？？？）<br>border总是依从layer的bounds，即使sublayer超出layer的bounds或者the backing image has an alpha mask containing transparent areas.<h4 id="Drop-Shadows"><a href="#Drop-Shadows" class="headerlink" title="Drop Shadows"></a>Drop Shadows</h4>drop shadow扮演一个表现深度的角色。它通常用来表明layering and priority,但有时被用来加强效果。</li>
<li>shadowOPacity (默认值为0.0, 值的范围为0.0~1.0)。可以通过与shadowColor、shadowOffset、shadowRadius加强表现效果。</li>
<li>shadowColor 阴影的颜色，默认黑色</li>
<li>shadowOffset  CGSize, 默认值为{0, -3}, 默认阴影在上方</li>
<li>shadowRadius 阴影的模糊效果<h4 id="Shadow-Clipping"><a href="#Shadow-Clipping" class="headerlink" title="Shadow Clipping"></a>Shadow Clipping</h4>shandow依从the exact shape of layer’s contents, not just the bounds and  cornerRadius。</li>
<li>shadowPath 实时计算shadow很耗费CPU（especially if the layer contains multiple sublayers, each with alpha-masked backing images.）如果我们知道想要的shadow，可以通过指定shadowPath来提高性能。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//create a square shadow</span><br><span class="line">CGMutablePathRef squarePath = CGPathCreateMutable(); CGPathAddRect(squarePath, NULL, self.layerView1.bounds); self.layerView1.layer.shadowPath = squarePath; CGPathRelease(squarePath);</span><br><span class="line"></span><br><span class="line">//create a circular shadow</span><br><span class="line">CGMutablePathRef circlePath = CGPathCreateMutable(); CGPathAddEllipseInRect(circlePath, NULL, self.layerView2.bounds); self.layerView2.layer.shadowPath = circlePath; CGPathRelease(circlePath);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Layer-Masking"><a href="#Layer-Masking" class="headerlink" title="Layer Masking"></a>Layer Masking</h3><ul>
<li>mask mask是CALayer类型，mask的颜色没有用，我们需要的是它的形状。如我们把一个白色的正方形Layer的mask设置为一个黑色三角形Layer,我们将会看到一个白色三角形的Layer。(可以想象成我们是把layer裁剪成mask的形状)<blockquote>
<p>The really cool feature of CALayer masking is that you are not limited to using static images for your masks. Anything that can be composed out of layers can be used as the mask property, which means that your masks can be created dynamically using code, and even animated in real time.</p>
</blockquote>
<h3 id="Scaling-Filters"><a href="#Scaling-Filters" class="headerlink" title="Scaling Filters"></a>Scaling Filters</h3></li>
<li>kCAFilterNearest和kCAFilterTrilinear</li>
</ul>
<h3 id="Group-Opacity"><a href="#Group-Opacity" class="headerlink" title="Group Opacity"></a>Group Opacity</h3><ul>
<li>opacity (UIView has an equivalent property called alpha). 这个属性会影响sublayer的opacity</li>
<li>shouldRasterize opacity会对它的sublayer起作用，它们的opacity会混合在一起，有可能不是我们想要的效果。这时就轮到shouldRasterize出场了，set shouldRasterize to YES, the layer and its sublayers will be collapsed into a single flat image before the opacity is applied.</li>
<li><p>rasterizationScale</p>
<blockquote>
<p>By default, all layers are rasterized at a scale of 1.0,so if you use the shouldRasterize property, you should always ensure that you set the<br>rasterizationScale to match the screen to avoid views that look pixelated on a Retina display. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// enable rasterization for the translucent button</span><br><span class="line">button2.layer.shouldRasterize = YES;</span><br><span class="line">button2.layer.rasterizationScale = [UIScreen mainScreen].scale;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>UIViewGroupOpacity 我们可以在Info.plist中添加UIViewGroupOpacity并把它设置为YES.这会影响整个App</p>
</li>
</ul>
<h3 id="Transforms"><a href="#Transforms" class="headerlink" title="Transforms"></a>Transforms</h3><h4 id="Affine-Transforms"><a href="#Affine-Transforms" class="headerlink" title="Affine Transforms"></a>Affine Transforms</h4><ul>
<li>affineTransform (It’s equal to the UIView transform property)</li>
<li>transform (It’s type is CATransform3D)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CGAffineTransformConcat(CGAffineTransform t1, CGAffineTransform t2);</span><br><span class="line">create a new CGAffineTransform martix from two existing ones.</span><br></pre></td></tr></table></figure>
<p>We can create a computed  transform using several functions<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//create a new transform</span><br><span class="line">CGAffineTransform transform = CGAffineTransformIdentity; //scale by 50%</span><br><span class="line">transform = CGAffineTransformScale(transform, 0.5, 0.5); //rotate by 30 degrees</span><br><span class="line">transform = CGAffineTransformRotate(transform, M_PI / 180.0 * 30.0); //translate by 200 points</span><br><span class="line">transform = CGAffineTransformTranslate(transform, 200, 0);</span><br><span class="line">//apply transform to layer</span><br><span class="line">self.layerView.layer.affineTransform = transform;</span><br></pre></td></tr></table></figure></p>
<p><strong>Notice</strong></p>
<blockquote>
<p>A translation followed by rotation is not the same as a rotation followed by a translation.</p>
</blockquote>
<h4 id="The-Shear-Transform"><a href="#The-Shear-Transform" class="headerlink" title="The Shear Transform"></a>The Shear Transform</h4><h3 id="3D-Transforms"><a href="#3D-Transforms" class="headerlink" title="3D Transforms"></a>3D Transforms</h3><h4 id="The-Vanishing-Point"><a href="#The-Vanishing-Point" class="headerlink" title="The Vanishing Point"></a>The Vanishing Point</h4><blockquote>
<p>Core Animation defines the vanishing point as being located at the anchorPoint of the layer being transformed.<br>When you change the position of a layer, you also change its vanishing point. This is important to remember when you are working in 3D.   </p>
</blockquote>
<h4 id="The-sublayerTransform-Property"><a href="#The-sublayerTransform-Property" class="headerlink" title="The sublayerTransform Property"></a>The sublayerTransform Property</h4><ul>
<li>sublayerTransform</li>
<li>Backfaces, 如果我们将一个视图旋转180度，此时视图的景象与本来景象在镜子中的反射景象相同。</li>
<li>doubleSided 该属性默认值为YES，如果设置为NO，那么layer翻转180度以后什么都看不到</li>
</ul>
<h3 id="Layer-Flattening"><a href="#Layer-Flattening" class="headerlink" title="Layer Flattening"></a>Layer Flattening</h3><h3 id="Solid-Objects"><a href="#Solid-Objects" class="headerlink" title="Solid Objects"></a>Solid Objects</h3><h3 id="Light-and-Shadow"><a href="#Light-and-Shadow" class="headerlink" title="Light and Shadow"></a>Light and Shadow</h3><ul>
<li>GLKMatrix4</li>
</ul>
<h3 id="Specialized-Layers"><a href="#Specialized-Layers" class="headerlink" title="Specialized Layers"></a>Specialized Layers</h3><h4 id="CAShapeLayer"><a href="#CAShapeLayer" class="headerlink" title="CAShapeLayer"></a>CAShapeLayer</h4><p>优点</p>
<ul>
<li>快速高效</li>
<li>搭配UIBezierPath可以快速的画出一些图形</li>
<li>可以</li>
</ul>
<h4 id="除了使用CAShapeLayer绘制圆角，UIBezierPath提供了分别控制矩形圆角大小的能力"><a href="#除了使用CAShapeLayer绘制圆角，UIBezierPath提供了分别控制矩形圆角大小的能力" class="headerlink" title="除了使用CAShapeLayer绘制圆角，UIBezierPath提供了分别控制矩形圆角大小的能力"></a>除了使用CAShapeLayer绘制圆角，UIBezierPath提供了分别控制矩形圆角大小的能力</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/define path parameters</span><br><span class="line">CGRect rect = CGRectMake(50, 50, 100, 100);</span><br><span class="line">CGSize radii = CGSizeMake(20, 20);</span><br><span class="line">UIRectCorner corners = UIRectCornerTopRight |</span><br><span class="line">UIRectCornerBottomRight | UIRectCornerBottomLeft;</span><br><span class="line">//create path</span><br><span class="line">UIBezierPath *path = [UIBezierPath bezierPathWithRoundedRect:rect byRoundingCorners:corners cornerRadii:radii];</span><br></pre></td></tr></table></figure>
<h4 id="CATextLayer"><a href="#CATextLayer" class="headerlink" title="CATextLayer"></a>CATextLayer</h4><p>渲染速度比UILabel快一些，使用上略麻烦，封装一些用起来简单一些。<br><strong>Notice</strong></p>
<blockquote>
<p>contentScale默认值为1.0,rentina屏幕上字体会看起来模糊，将contentScale设为与屏幕scale一致即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">textLayer.contentsScale = [UIScreen mainScreen].scale;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="CATransformLayer"><a href="#CATransformLayer" class="headerlink" title="CATransformLayer"></a>CATransformLayer</h4><h4 id="CAGradientLayer"><a href="#CAGradientLayer" class="headerlink" title="CAGradientLayer"></a>CAGradientLayer</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//create gradient layer and add it to our container view</span><br><span class="line">CAGradientLayer *gradientLayer = [CAGradientLayer layer];</span><br><span class="line">gradientLayer.frame = self.containerView.bounds;</span><br><span class="line">[self.containerView.layer addSublayer:gradientLayer];</span><br><span class="line"></span><br><span class="line">//set gradient colors</span><br><span class="line">gradientLayer.colors = @[(__bridge id)[UIColor redColor].CGColor,</span><br><span class="line">                            (__bridge id)[UIColor blueColor].CGColor];</span><br><span class="line"></span><br><span class="line">//set gradient start and end points</span><br><span class="line">gradientLayer.startPoint = CGPointMake(0, 0);</span><br><span class="line">gradientLayer.endPoint = CGPointMake(1, 1);</span><br></pre></td></tr></table></figure>
<h4 id="CAReplicatorLayer"><a href="#CAReplicatorLayer" class="headerlink" title="CAReplicatorLayer"></a>CAReplicatorLayer</h4><ul>
<li>用于产生多个相同控件或者生成镜面效果</li>
</ul>
<h4 id="CAScrollLayer"><a href="#CAScrollLayer" class="headerlink" title="CAScrollLayer"></a>CAScrollLayer</h4><ul>
<li>可以滚动的layer</li>
</ul>
<h4 id="CATiledLayer"><a href="#CATiledLayer" class="headerlink" title="CATiledLayer"></a>CATiledLayer</h4><ul>
<li>加载过大的图片时，不管UIImage-imageNamed:还是-imageWithContentsOfFile:</li>
<li>Core Animation 强制使用CPU处理图片而不是GPU</li>
<li>CATiledLayer通过把大图片分成多个小图片并且根据需要独立加载提供了一种高性能加载大图的解决方法</li>
</ul>
<h4 id="CAEmitterLayer"><a href="#CAEmitterLayer" class="headerlink" title="CAEmitterLayer"></a>CAEmitterLayer</h4><p>CAEmitterLayer作为CAEmitterCell的容器，可以制造烟、下雪、爆炸等场景。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// 一个爆炸效果</span><br><span class="line">//create particle emitter layer</span><br><span class="line">CAEmitterLayer *emitter = [CAEmitterLayer layer];</span><br><span class="line">emitter.frame = self.containerView.bounds;</span><br><span class="line">[self.containerView.layer addSublayer:emitter];</span><br><span class="line"></span><br><span class="line">//configure emitter</span><br><span class="line">emitter.renderMode = kCAEmitterLayerAdditive;</span><br><span class="line">emitter.emitterPosition = CGPointMake(emitter.frame.size.width / 2.0,</span><br><span class="line">                                        emitter.frame.size.height / 2.0);</span><br><span class="line"></span><br><span class="line">//create a particle template</span><br><span class="line">CAEmitterCell *cell = [[CAEmitterCell alloc] init];</span><br><span class="line">cell.contents = (__bridge id)[UIImage imageNamed:@&quot;Spark.png&quot;].CGImage;</span><br><span class="line">cell.birthRate = 150;</span><br><span class="line">cell.lifetime = 5.0;</span><br><span class="line">cell.color = [UIColor colorWithRed:1 green:0.5 blue:0.2 alpha:1.0].CGColor;</span><br><span class="line">cell.alphaSpeed = -0.4;</span><br><span class="line">cell.velocity = 50;</span><br><span class="line">cell.velocityRange = 50;</span><br><span class="line">cell.emissionRange = M_PI * 2.0;</span><br><span class="line"></span><br><span class="line">//add particle template to emitter</span><br><span class="line">emitter.emitterCells = @[cell];</span><br></pre></td></tr></table></figure></p>
<h4 id="CAEAGLLayer"><a href="#CAEAGLLayer" class="headerlink" title="CAEAGLLayer"></a>CAEAGLLayer</h4><p>利用GPU，性能好，使用略繁琐。</p>
<h4 id="AVPlayerLayer-属于AVfoundation-不属于Core-Animation"><a href="#AVPlayerLayer-属于AVfoundation-不属于Core-Animation" class="headerlink" title="AVPlayerLayer  属于AVfoundation,不属于Core Animation"></a>AVPlayerLayer  属于AVfoundation,不属于Core Animation</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 简单的使用方式</span><br><span class="line">//get video URL</span><br><span class="line">NSURL *URL = [[NSBundle mainBundle] URLForResource:@&quot;Ship&quot;</span><br><span class="line">                                        withExtension:@&quot;mp4&quot;];</span><br><span class="line"></span><br><span class="line">//create player and player layer</span><br><span class="line">AVPlayer *player = [AVPlayer playerWithURL:URL];</span><br><span class="line">AVPlayerLayer *playerLayer = [AVPlayerLayer playerLayerWithPlayer:player];    </span><br><span class="line"></span><br><span class="line">//set player layer frame and attach it to our view</span><br><span class="line">playerLayer.frame = self.containerView.bounds;</span><br><span class="line">[self.containerView.layer addSublayer:playerLayer];</span><br><span class="line"></span><br><span class="line">//play the video</span><br><span class="line">[player play];</span><br></pre></td></tr></table></figure>
<h3 id="Implict-Animations"><a href="#Implict-Animations" class="headerlink" title="Implict Animations"></a>Implict Animations</h3><p>隐式动画总是自动执行，除非告诉它不要这么做。</p>
<h4 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h4><p>Core Aniamtion假设屏幕上的所有东西都会被animated。</p>
<p>Transactions被用来封装一组的动画<br>用法如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//begin a new transaction</span><br><span class="line">[CATransaction begin];</span><br><span class="line"></span><br><span class="line">//set the animation duration to 1 second</span><br><span class="line">[CATransaction setAnimationDuration:1.0];</span><br><span class="line"></span><br><span class="line">//randomize the layer background color</span><br><span class="line">CGFloat red = arc4random() / (CGFloat)INT_MAX;</span><br><span class="line">CGFloat green = arc4random() / (CGFloat)INT_MAX;</span><br><span class="line">CGFloat blue = arc4random() / (CGFloat)INT_MAX;</span><br><span class="line">self.colorLayer.backgroundColor = [UIColor colorWithRed:red</span><br><span class="line">                                                    green:green</span><br><span class="line">                                                    blue:blue</span><br><span class="line">                                                    alpha:1.0].CGColor;</span><br><span class="line"></span><br><span class="line">//commit the transaction</span><br><span class="line">[CATransaction commit];</span><br></pre></td></tr></table></figure></p>
<p>UIView的+beginAnimations:context:和+commitAnimations这一组方法以及+animateWithDuration:animations:的内部其实还是CATransaction方法。</p>
<h4 id="Completion-Block"><a href="#Completion-Block" class="headerlink" title="Completion Block"></a>Completion Block</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//begin a new transaction</span><br><span class="line">[CATransaction begin];</span><br><span class="line"></span><br><span class="line">//set the animation duration to 1 second</span><br><span class="line">[CATransaction setAnimationDuration:1.0];</span><br><span class="line"></span><br><span class="line">//add the spin animation on completion</span><br><span class="line">[CATransaction setCompletionBlock:^&#123;</span><br><span class="line">    </span><br><span class="line">    //rotate the layer 90 degrees</span><br><span class="line">    CGAffineTransform transform = self.colorLayer.affineTransform;</span><br><span class="line">    transform = CGAffineTransformRotate(transform, M_PI_2);</span><br><span class="line">    self.colorLayer.affineTransform = transform;</span><br><span class="line"></span><br><span class="line">    // 上面的动画使用默认的transaction, 默认的动画时间是0.25 seconds.</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//randomize the layer background color</span><br><span class="line">CGFloat red = arc4random() / (CGFloat)INT_MAX;</span><br><span class="line">CGFloat green = arc4random() / (CGFloat)INT_MAX;</span><br><span class="line">CGFloat blue = arc4random() / (CGFloat)INT_MAX;</span><br><span class="line">self.colorLayer.backgroundColor = [UIColor colorWithRed:red</span><br><span class="line">                                                    green:green</span><br><span class="line">                                                    blue:blue</span><br><span class="line">                                                    alpha:1.0].CGColor;</span><br><span class="line"></span><br><span class="line">//commit the transaction</span><br><span class="line">[CATransaction commit];</span><br></pre></td></tr></table></figure>
<h4 id="Layer-Actions"><a href="#Layer-Actions" class="headerlink" title="Layer Actions"></a>Layer Actions</h4><p>CALayer执行动画时有下面这四个步骤</p>
<blockquote>
<p>The animations that CALayer automatically applies when properties are changed are called actions. When a property of a CALayer is modified, it calls its -actionForKey: method, passing the name of the property in question. What happens next is quite nicely documented in the header file for CALayer, but it essentially boils down to this:</p>
<ol>
<li>The layer first checks whether it has a delegate and if the delegate implements the -actionForLayer:forKey method specified in the CALayerDelegate protocol. If it does, it will call it and return the result.</li>
<li>If there is no delegate, or the delegate does not implement -actionForLayer:forKey, the layer checks in its actions dictionary, which contains a mapping of property names to actions.</li>
<li>If the actions dictionary does not contain an entry for the property in question, the layer searches inside its style dictionary hierarchy for any actions that match the property name.</li>
<li>Finally, if it fails to find a suitable action anywhere in the style hierarchy, the layer will fall back to calling the -defaultActionForKey: method, which defines standard actions for known properties.</li>
</ol>
</blockquote>
<p>UIView在animation block外部禁用了隐式动画。<br>禁用隐式动画有两种方式，</p>
<ul>
<li>[CATransaction setDisableActions:YES];</li>
<li>return nil for the property actions</li>
</ul>
<p>两个知识点  </p>
<ul>
<li>UIView backing layer 禁用了隐式动画。想要启动一些属性的动画可以使用UIView animation block的相关方法或者是子类化UIView然后重写-actionForLayer:forKey: 方法或者使用explicit animation。</li>
<li>For hosted(that is, nonbacking)layers, 我们可以通过实现-actionForLayer:forKey: layer delegate method或者提供actions dictionary 来控制动画。</li>
</ul>
<p>提供action, CATransition的祖先实现了CAAction<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//create sublayer</span><br><span class="line">self.colorLayer = [CALayer layer];</span><br><span class="line">self.colorLayer.frame = CGRectMake(50.0f, 50.0f, 100.0f, 100.0f);</span><br><span class="line">self.colorLayer.backgroundColor = [UIColor blueColor].CGColor;</span><br><span class="line"></span><br><span class="line">//add a custom action</span><br><span class="line">CATransition *transition = [CATransition animation];</span><br><span class="line">transition.type = kCATransitionPush;</span><br><span class="line">transition.subtype = kCATransitionFromLeft;</span><br><span class="line">self.colorLayer.actions = @&#123;@&quot;backgroundColor&quot;: transition&#125;;</span><br><span class="line"></span><br><span class="line">//add it to our view</span><br><span class="line">[self.layerView.layer addSublayer:self.colorLayer];</span><br></pre></td></tr></table></figure></p>
<h4 id="Presentation-Versus-Model"><a href="#Presentation-Versus-Model" class="headerlink" title="Presentation Versus Model"></a>Presentation Versus Model</h4><p>我们看到的layer可以细分为两个，一个是presentationLayer，另一个是model Layer。当我们改变model Layer的proerpty时，model Layer的property立即被改变。我们看到的动画的主要由presetationLayer负责。可以通过访问一个layer的presentationLayer的property来获得一些实时的property value。</p>
<h3 id="Explict-Animations"><a href="#Explict-Animations" class="headerlink" title="Explict Animations"></a>Explict Animations</h3><p>显示动画可以让我们创建一些非线性的动画，比如说沿着曲线移动。</p>
<h4 id="Property-Animations"><a href="#Property-Animations" class="headerlink" title="Property Animations"></a>Property Animations</h4><p>属性动画可以时layer的一个属性的一个值的改变，也可以是一组值。<br>属性动画也可以分成basic和keyframe</p>
<h5 id="Basic-Animations"><a href="#Basic-Animations" class="headerlink" title="Basic Animations"></a>Basic Animations</h5><ul>
<li>一个需要注意的地方时basic animation作用于presenation layer, model layer并未改变，动画完成之后，model layer还是原来的值，这个地方需要我们自己去处理<h5 id="CAAmimationDelegate"><a href="#CAAmimationDelegate" class="headerlink" title="CAAmimationDelegate"></a>CAAmimationDelegate</h5>使用隐式动画时我们可以利用completion block 去检测动画是否已经完成。但是该方法不能作用于显示动画。我们可以通过实现CAAnimationDelegate协议来检测动画是否已经完成。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)animationDidStop:(CABasicAnimation *)anim finished:(BOOL)flag &#123;</span><br><span class="line">//set the backgroundColor property to match animation toValue</span><br><span class="line">[CATransaction begin];</span><br><span class="line">[CATransaction setDisableActions:YES]; self.colorLayer.backgroundColor = (__bridge CGColorRef)anim.toValue; [CATransaction commit];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>Question: 如何区分不同的animation?<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[anim setValue:@&quot;&quot; forKey:@&quot;&quot;];</span><br><span class="line">给不同的animatin设置不同的key value, 然后在代理方法中拿到相关值进行区分。</span><br><span class="line">- (void)animationDidStop:(CABasicAnimation *)anim finished:(BOOL)flag &#123;</span><br><span class="line">    if ([[anim valueForKey:@&quot;&quot;] isEqualToString:@&quot;&quot;]) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="Keyframe-Animations"><a href="#Keyframe-Animations" class="headerlink" title="Keyframe Animations"></a>Keyframe Animations</h4><p>CABasicAnimation向我们展示了隐式动画的机制，但是使用起来略繁琐。我们可以使用hosted layers的隐式动画或者UIView animation for views and backing layer来达到相同的效果，而且更简单。<br>相比CABasicAnimation，CAKeyframeAnimation更强大。CABasicAnimation需要a single start and end value，但是CAKeyframeAnimation可以使用一组值来做动画。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//create a keyframe animation</span><br><span class="line">CAKeyframeAnimation *animation = [CAKeyframeAnimation animation];</span><br><span class="line">animation.keyPath = @&quot;backgroundColor&quot;;</span><br><span class="line">animation.duration = 2.0;</span><br><span class="line">animation.values = @[</span><br><span class="line">                        (__bridge id)[UIColor blueColor].CGColor,</span><br><span class="line">                        (__bridge id)[UIColor redColor].CGColor,</span><br><span class="line">                        (__bridge id)[UIColor greenColor].CGColor,</span><br><span class="line">                        (__bridge id)[UIColor blueColor].CGColor</span><br><span class="line">                        ];</span><br><span class="line"></span><br><span class="line">//apply animation to layer</span><br><span class="line">[self.colorLayer addAnimation:animation forKey:nil];</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//create the keyframe animation</span><br><span class="line">CAKeyframeAnimation *animation = [CAKeyframeAnimation animation];</span><br><span class="line">animation.keyPath = @&quot;position&quot;;</span><br><span class="line">animation.duration = 4.0;</span><br><span class="line">animation.path = bezierPath.CGPath;</span><br><span class="line">[shipLayer addAnimation:animation forKey:nil];</span><br><span class="line">// 以上代码在实际运行过程中，飞船并不会调头，我们可以使用以下代码让其运动更自然</span><br><span class="line">animation.rotationMode = kCAAnimationRotateAuto;</span><br></pre></td></tr></table></figure>
<h4 id="Virtual-Properties"><a href="#Virtual-Properties" class="headerlink" title="Virtual Properties"></a>Virtual Properties</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//animate the ship rotation</span><br><span class="line">CABasicAnimation *animation = [CABasicAnimation animation];</span><br><span class="line">animation.keyPath = @&quot;transform.rotation&quot;;</span><br><span class="line">animation.duration = 2.0;</span><br><span class="line">animation.byValue = @(M_PI * 2);</span><br><span class="line">[shipLayer addAnimation:animation forKey:nil];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Notice<br>You cannot set properties like transform.position、transform.rotation or transform.scale directly; they can only be used for animation. </p>
</blockquote>
<h3 id="Animation-Groups"><a href="#Animation-Groups" class="headerlink" title="Animation Groups"></a>Animation Groups</h3><p>CABasicAnmation and CAKeyFrameAnimation target individual properties, multiple such animations can be gathered together using CAAnimationGroup。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">//create a path</span><br><span class="line">UIBezierPath *bezierPath = [[UIBezierPath alloc] init];</span><br><span class="line">[bezierPath moveToPoint:CGPointMake(0, 150)];</span><br><span class="line">[bezierPath addCurveToPoint:CGPointMake(300, 150)</span><br><span class="line">                controlPoint1:CGPointMake(75, 0)</span><br><span class="line">                controlPoint2:CGPointMake(225, 300)];</span><br><span class="line"></span><br><span class="line">//draw the path using a CAShapeLayer</span><br><span class="line">CAShapeLayer *pathLayer = [CAShapeLayer layer];</span><br><span class="line">pathLayer.path = bezierPath.CGPath;</span><br><span class="line">pathLayer.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">pathLayer.strokeColor = [UIColor redColor].CGColor;</span><br><span class="line">pathLayer.lineWidth = 3.0f;</span><br><span class="line">[self.containerView.layer addSublayer:pathLayer];</span><br><span class="line"></span><br><span class="line">//add a colored layer</span><br><span class="line">CALayer *colorLayer = [CALayer layer];</span><br><span class="line">colorLayer.frame = CGRectMake(0, 0, 64, 64);</span><br><span class="line">colorLayer.position = CGPointMake(0, 150);</span><br><span class="line">colorLayer.backgroundColor = [UIColor greenColor].CGColor;</span><br><span class="line">[self.containerView.layer addSublayer:colorLayer];</span><br><span class="line"></span><br><span class="line">//create the position animation</span><br><span class="line">CAKeyframeAnimation *animation1 = [CAKeyframeAnimation animation];</span><br><span class="line">animation1.keyPath = @&quot;position&quot;;</span><br><span class="line">animation1.path = bezierPath.CGPath;</span><br><span class="line">animation1.rotationMode = kCAAnimationRotateAuto;</span><br><span class="line"></span><br><span class="line">//create the color animation</span><br><span class="line">CABasicAnimation *animation2 = [CABasicAnimation animation];</span><br><span class="line">animation2.keyPath = @&quot;backgroundColor&quot;;</span><br><span class="line">animation2.toValue = (__bridge id)[UIColor redColor].CGColor;</span><br><span class="line"></span><br><span class="line">//create group animation</span><br><span class="line">CAAnimationGroup *groupAnimation = [CAAnimationGroup animation];</span><br><span class="line">groupAnimation.animations = @[animation1, animation2];</span><br><span class="line">groupAnimation.duration = 4.0;</span><br><span class="line"></span><br><span class="line">//add the animation to the color layer</span><br><span class="line">[colorLayer addAnimation:groupAnimation forKey:nil];</span><br></pre></td></tr></table></figure></p>
<h3 id="Transitions"><a href="#Transitions" class="headerlink" title="Transitions"></a>Transitions</h3><p>transition animation 作用于整个layer, transition animation 对old layer 进行截图，然后在新的视图上做文章。</p>
<ul>
<li>type 有kCATransitionFade(default)、kCATransitionMoveIn、kCATransitionMoveIn和kCATransitionReveal</li>
<li>subtype kCATransitionMoveIn、kCATransitionMoveIn和kCATransitionReveal带有默认的方向，但是可以通过subtype去修改。subtype主要有以下值kCATransitionFromRight、kCATransitionFromLeft、kCATransitionFromTop和kCATransitionFromBottom。</li>
</ul>
<h4 id="Implicit-Transitions"><a href="#Implicit-Transitions" class="headerlink" title="Implicit Transitions"></a>Implicit Transitions</h4><blockquote>
<p>Notice<br>自己创建的layer，修改contents，会自动加上隐式动画crossfade。但是view backing layer禁用了所有的隐式动画</p>
</blockquote>
<h4 id="Animating-Layer-Tree-Changes"><a href="#Animating-Layer-Tree-Changes" class="headerlink" title="Animating Layer Tree Changes"></a>Animating Layer Tree Changes</h4><ul>
<li>可以在-tabBarController:didSelectViewController:方法中对controller的切换加一些transition animation</li>
</ul>
<h4 id="Custom-Transitions"><a href="#Custom-Transitions" class="headerlink" title="Custom Transitions"></a>Custom Transitions</h4><ul>
<li>截图</li>
</ul>
<h3 id="Canceling-an-Animation-in-Progress"><a href="#Canceling-an-Animation-in-Progress" class="headerlink" title="Canceling an Animation in Progress"></a>Canceling an Animation in Progress</h3><p>相关方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (CAAnimation *)animationForKey:(NSString *)key;</span><br><span class="line">- (void)removeAnimationForKey:(NSString *)key;</span><br><span class="line">- (void)removeAllAnimations;</span><br></pre></td></tr></table></figure></p>
<p>正在进行中的动画不能被修改，但是可以remove。remove之后，layer呈现出 current model value的值。</p>
<h3 id="Layer-Time"><a href="#Layer-Time" class="headerlink" title="Layer Time"></a>Layer Time</h3><h4 id="The-CAMediaTiming-Protocol"><a href="#The-CAMediaTiming-Protocol" class="headerlink" title="The CAMediaTiming Protocol"></a>The CAMediaTiming Protocol</h4><p>The CAMediaTiming protocol定义了一些用来控制动画时间的proerpties。CALayer and CAAnimation都遵守该协议，所以时间可以从per-layer and per-animtion层面进行控制。</p>
<h4 id="Duartion-and-Repetition"><a href="#Duartion-and-Repetition" class="headerlink" title="Duartion and Repetition"></a>Duartion and Repetition</h4><p>the total time = duration * repeatcount<br>the duration and repeatCount proeprties both default to zero. a value of zero in this case, is just used to mean “use the defaults”, which are 0.25 seconds and one iteration.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// a simple sample</span><br><span class="line">CFTimeInterval duration = [self.durationField.text doubleValue];</span><br><span class="line">float repeatCount = [self.repeatField.text floatValue];</span><br><span class="line">    </span><br><span class="line">//animate the ship rotation</span><br><span class="line">CABasicAnimation *animation = [CABasicAnimation animation];</span><br><span class="line">animation.keyPath = @&quot;transform.rotation&quot;;</span><br><span class="line">animation.duration = duration;</span><br><span class="line">animation.repeatCount = repeatCount;</span><br><span class="line">animation.byValue = @(M_PI * 2);</span><br><span class="line">animation.delegate = self;</span><br><span class="line">[self.shipLayer addAnimation:animation forKey:@&quot;rotateAnimation&quot;];</span><br><span class="line"></span><br><span class="line">//disable controls</span><br><span class="line">[self setControlsEnabled:NO];</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// repaetaDuration 动画的“时间寿命”</span><br><span class="line">// another sample </span><br><span class="line">//apply perspective transform</span><br><span class="line">CATransform3D perspective = CATransform3DIdentity;</span><br><span class="line">perspective.m34 = -1.0 / 500.0;</span><br><span class="line">self.containerView.layer.sublayerTransform = perspective;</span><br><span class="line"></span><br><span class="line">//apply swinging animation</span><br><span class="line">CABasicAnimation *animation = [CABasicAnimation animation];</span><br><span class="line">animation.keyPath = @&quot;transform.rotation.y&quot;;</span><br><span class="line">animation.toValue = @(-M_PI_2);</span><br><span class="line">animation.duration = 2.0;</span><br><span class="line">animation.repeatDuration = INFINITY;</span><br><span class="line">animation.autoreverses = YES;</span><br><span class="line">[doorLayer addAnimation:animation forKey:nil];</span><br></pre></td></tr></table></figure>
<h4 id="Relative-Time"><a href="#Relative-Time" class="headerlink" title="Relative Time"></a>Relative Time</h4><ul>
<li>beginTime 动画的开始时间（类似于delay）.默认为0，从animation被add到visible layer的那一刻开始计算</li>
<li>speed 如果duration是1, speed是2, 动画0.5s就会完成</li>
<li>timeOffset 如果duartion是1s, timeOffset是0.5s, 这意味着动画从完整过程的一半开始执行</li>
</ul>
<h4 id="fillMode"><a href="#fillMode" class="headerlink" title="fillMode"></a>fillMode</h4><h3 id="Hierarchical-Time"><a href="#Hierarchical-Time" class="headerlink" title="Hierarchical Time"></a>Hierarchical Time</h3><p>Each animation and layer has its own hierarchical concept of time, measured relative to its parent. Adjusting the timing for a layer will affect its own animations and those of its sublayers, but not its superlayer. The same goes for animations that are grouped hierarchically (using nested CAAnimationGroup instances).<br>Adjusting the duration and repeatCount/repeatDuration properties for a CALayer or CAGroupAnimation will not affect its children’s animations. The beginTime, timeOffset, and speed properties will impact child animations, however. In hierarchical terms, beginTime specifies a time offset between when the parent layer (or parent animation in the case of a grouped animation) starts animating and when the object in question should begin its own animation. Similarly, adjusting the speed property of a CALayer or CAGroupAnimation will apply a scaling factor to the animation speed for all of the children, as well.</p>
<h4 id="Global-Versus-Local-Time"><a href="#Global-Versus-Local-Time" class="headerlink" title="Global Versus Local Time"></a>Global Versus Local Time</h4><h4 id="Pause-Rewind-and-Fast-Forward"><a href="#Pause-Rewind-and-Fast-Forward" class="headerlink" title="Pause, Rewind, and Fast-Forward"></a>Pause, Rewind, and Fast-Forward</h4><p>self.window.layer.speed = 100; 使用该方法可以用于在自动化测试中加快测试速度。</p>
<h3 id="Manual-Animation"><a href="#Manual-Animation" class="headerlink" title="Manual Animation"></a>Manual Animation</h3><h2 id="Easing"><a href="#Easing" class="headerlink" title="Easing"></a>Easing</h2><h3 id="Animation-Velocity"><a href="#Animation-Velocity" class="headerlink" title="Animation Velocity"></a>Animation Velocity</h3><p>velocity = change / time</p>
<h3 id="CAMediaTimingFunction"><a href="#CAMediaTimingFunction" class="headerlink" title="CAMediaTimingFunction"></a>CAMediaTimingFunction</h3><blockquote>
<p>Notice<br>UIKit animation doesn’t work with hosted layers.</p>
</blockquote>
<h3 id="Easing-and-KeyFrame-Animations"><a href="#Easing-and-KeyFrame-Animations" class="headerlink" title="Easing and KeyFrame Animations"></a>Easing and KeyFrame Animations</h3><h3 id="Custom-Easing-Functions"><a href="#Custom-Easing-Functions" class="headerlink" title="Custom Easing Functions"></a>Custom Easing Functions</h3><ul>
<li>functionWithName:</li>
<li>functionWithControlPoints::::</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 改变坐标系原点位置</span><br><span class="line">//flip geometry so that 0,0 is in the bottom-left</span><br><span class="line">self.layerView.layer.geometryFlipped = YES;</span><br></pre></td></tr></table></figure>
<h4 id="Keyframe-Based-Easing"><a href="#Keyframe-Based-Easing" class="headerlink" title="Keyframe-Based Easing"></a>Keyframe-Based Easing</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//reset ball to top of screen</span><br><span class="line">self.ballView.center = CGPointMake(150, 32);</span><br><span class="line"></span><br><span class="line">//create keyframe animation</span><br><span class="line">CAKeyframeAnimation *animation = [CAKeyframeAnimation animation];</span><br><span class="line">animation.keyPath = @&quot;position&quot;;</span><br><span class="line">animation.duration = 1.0;</span><br><span class="line">animation.delegate = self;</span><br><span class="line">animation.values = @[</span><br><span class="line">    [NSValue valueWithCGPoint:CGPointMake(150, 32)],</span><br><span class="line">    [NSValue valueWithCGPoint:CGPointMake(150, 268)],</span><br><span class="line">    [NSValue valueWithCGPoint:CGPointMake(150, 140)],</span><br><span class="line">    [NSValue valueWithCGPoint:CGPointMake(150, 268)],</span><br><span class="line">    [NSValue valueWithCGPoint:CGPointMake(150, 220)],</span><br><span class="line">    [NSValue valueWithCGPoint:CGPointMake(150, 268)],</span><br><span class="line">    [NSValue valueWithCGPoint:CGPointMake(150, 250)],</span><br><span class="line">    [NSValue valueWithCGPoint:CGPointMake(150, 268)]</span><br><span class="line">];</span><br><span class="line">animation.timingFunctions = @[</span><br><span class="line">    [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn],</span><br><span class="line">    [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut],</span><br><span class="line">    [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn],</span><br><span class="line">    [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut],</span><br><span class="line">    [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn],</span><br><span class="line">    [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut],</span><br><span class="line">    [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn]</span><br><span class="line">];</span><br><span class="line">animation.keyTimes = @[@0.0, @0.3, @0.5, @0.7, @0.8, @0.9, @0.95, @1.0];</span><br><span class="line"></span><br><span class="line">//apply animation</span><br><span class="line">self.ballView.layer.position = CGPointMake(150, 268);</span><br><span class="line">[self.ballView.layer addAnimation:animation forKey:nil];</span><br></pre></td></tr></table></figure>
<h3 id="Timer-Based-Animation"><a href="#Timer-Based-Animation" class="headerlink" title="Timer-Based Animation"></a>Timer-Based Animation</h3><h4 id="Frame-Timeing"><a href="#Frame-Timeing" class="headerlink" title="Frame Timeing"></a>Frame Timeing</h4><h5 id="NSTimer"><a href="#NSTimer" class="headerlink" title="NSTimer"></a>NSTimer</h5><blockquote>
<p>Notice<br>Every thread on iOS maintains an NSRunloop, which in simple terms is a loop that endlessly works through a list of tasks it needs to perform. For the main thread, these tasks might include the following:  </p>
<ul>
<li>Processing touch events</li>
<li>Sending and receiving network packets</li>
<li>Executing code scheduled using GCD(Grand Central Dispatch)</li>
<li>Handling timer actions</li>
<li>Redrawing the screen<br>当床创建一个NSTimer的时候，它会被放到task list中，直到指定的时间带来时它都不会被执行。NSTimer等待的时间没有上限，只有等task list中前一个任务被执行完它才有可能被执行。<br>通常在指定的时间a few millseconds之内NSTimer会被执行，但是如果前一个任务完成的很慢，NStimer等待的时间可能会长一些。<br>The screen redrawing is scheduled to happen every sixtieth of a second, but just like a timer action, it may get delayed by an earlier task in the list that takes too long to execute.<br>因为这些delays是随机的，确保一个timer scheduled to fire every sixtieth of a second will always fire before the screen is redrawn是不可能的。有时候调用的太晚，动画看起来choppy, 有时候fire twice between updates, 导致a skipped frame<br>that will make the animation appear to jump forward.<br>改善方案如下</li>
<li>CADispalyLink that is designed to fire in lockstep with the screen refresh.</li>
<li>让我们动画基于the acutal recoreded frame 而不是假设frames准时执行。</li>
<li>调整animation timers的run loop mode从而使它不被其它时间延迟。</li>
</ul>
</blockquote>
<h4 id="CADisplayLink"><a href="#CADisplayLink" class="headerlink" title="CADisplayLink"></a>CADisplayLink</h4><p>通过确保帧率尽可能的连续，CADisplayLink比NSTimer能产生更自然的动画。但是CADisplayLink也不能确保每一帧都按期执行。<br>CADisplayLink与NStimer的区别是，即使延迟了,NStimer也会执行，CADisplayLink会跳过那些错失的事项去到下一次指定的时间。</p>
<h4 id="Mesauring-Frame-Duration"><a href="#Mesauring-Frame-Duration" class="headerlink" title="Mesauring Frame Duration"></a>Mesauring Frame Duration</h4><h4 id="Run-Loop-Modes"><a href="#Run-Loop-Modes" class="headerlink" title="Run Loop Modes"></a>Run Loop Modes</h4><p>每一添加到RunLoop的ta都有一个优先级。如果有太多的UI activity，为了确保流畅的UI体验iOS将会给予user interface相关任以优先级同时其它任务可能会被暂停一小段时间。<br>一个典型的例滚动UIScrollView。滚动期间，scrollView的重绘优先级高于其它任务所以标准的NSTimer和网络时间可能在滚动期间不会被执行。<br>Run Loop 的几种模式</p>
<ul>
<li>NSDefaultRunLoopMode-The standard pirority</li>
<li>NSRunLoopCommonModes-High pirority</li>
<li>UITrackingRunLoopMode<br>当你的动画在一个高帧率运行时，使用NSRunLoopCommonModes需要注意这可能导致其它任务比如NTimer或者其它的动画比如说滚动将会停止更新直到你的动画结束。</li>
</ul>
<p>同一时间以多个run loop modes 使用一个CADisplayLink。  </p>
<blockquote>
<p>It’s possible to use a CADisplayLink with multiple run loop modes at the same time, so we could add it to both NSDefaultRunLoopMode and UITrackingRunLoopMode to ensure that it is not disrupted by scrolling, without interfering with the performance of other UIKit control animations, like this:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self.timer = [CADisplayLink displayLinkWithTarget:self selector:@selector(step:)];</span><br><span class="line">[self.timer addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSDefaultRunLoopMode];</span><br><span class="line">[self.timer addToRunLoop:[NSRunLoop mainRunLoop] forMode:UITrackingRunLoopMode];</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="Physical-Simulation"><a href="#Physical-Simulation" class="headerlink" title="Physical Simulation"></a>Physical Simulation</h3><h4 id="Chipmunk"><a href="#Chipmunk" class="headerlink" title="Chipmunk"></a>Chipmunk</h4><h4 id="GPU-Bound-Opearions"><a href="#GPU-Bound-Opearions" class="headerlink" title="GPU-Bound Opearions"></a>GPU-Bound Opearions</h4><ul>
<li>Too much geometry</li>
<li>Too much overdraw</li>
<li>Offscreen drawing - 通常当一个特殊的效果不能直接被绘制在屏幕上时，就会发生离屏渲染。离屏渲染可能会使用CPU或者GPU，但是无论使用哪个都会为离屏图片申请额外的内存并且会在绘制上下文中进行切换。这两者都会拖慢GPU的性能。一些layer效果比如rounded corners, layer masks, drop shadows or layer rasterization都会迫使Core Animation提前进行离屏渲染。这并不代表说我们避免使用这些效果，而是说我们应该清楚地知道它们会有性能方面的影响。</li>
<li>Too-large images - 如果试图绘制一个超出GPU支持的尺寸（根据具体设备稍有不同）的图片，那么每一次图片被展示的时候，CPU都必须要被用来处理图片，这也会拖慢性能。</li>
</ul>
<h4 id="CPU-Bound-Operations"><a href="#CPU-Bound-Operations" class="headerlink" title="CPU-Bound Operations"></a>CPU-Bound Operations</h4><p>在Core Animation中，CPU的大部分工作都在animation开始之前。这通常不会影响frame rate，但是它可能会影响到动画的开始时间，造成界面响应不及时。</p>
<ul>
<li>Layout calculations - view层级非常复杂时，当一个view被呈现或者被修改时，计算所有layer的frame时可能会花一些时间。尤其是使用自动布局时，它比autoresizing更加耗费CPU。</li>
<li>Lazy view loading</li>
<li>Core Graphics drawing - -drawRect:和-drawLayer:inContext:,如果实现了CADelegate的这两个方法，就会在实际开始绘制之前就引入重大的性能影响。为了能够随意地在layer’s contetns 中绘制，Core Animation必须在内存中创建一个和View尺相等的backing image。一旦绘制完成，必须通过IPC把image data送到render server。在这个开销之上，Core Graphic的绘制非常慢，在性能要求严格的场景上，这可能不会是你想要的结果。</li>
<li>Image decompression - PNG和JPG等图片通常都被压缩了，但是图片在被会知道屏幕上时必须要被解压缩。如果是大图片，也要花费一定的时间来解压缩。</li>
</ul>
<h4 id="IO-Bound-Operations"><a href="#IO-Bound-Operations" class="headerlink" title="IO-Bound Operations"></a>IO-Bound Operations</h4><p>IO(比如访问flash storage和network interface),IO相比正常的memory access要慢得多。所以如果你的动画是IO—bound可能会有问题。通常使用线程，缓存和预加载可以解决这些问题。</p>
<h3 id="Measure，Don’t-Guess"><a href="#Measure，Don’t-Guess" class="headerlink" title="Measure，Don’t Guess"></a>Measure，Don’t Guess</h3><h4 id="Test-Reality-Not-a-Simulation"><a href="#Test-Reality-Not-a-Simulation" class="headerlink" title="Test Reality, Not a Simulation"></a>Test Reality, Not a Simulation</h4><ul>
<li>shouldRasterize属性会离屏渲染layer一次，然后保存结果直到下次更新。</li>
</ul>
<h2 id="Efficent-Drawing"><a href="#Efficent-Drawing" class="headerlink" title="Efficent Drawing"></a>Efficent Drawing</h2><h3 id="Software-Drawing"><a href="#Software-Drawing" class="headerlink" title="Software Drawing"></a>Software Drawing</h3><p>在Core Animation的上下文中，属于drawing通常代表software drawing(that is, drawing that is not GPU assited).iOS中的software drawing主要使用Core Graphics framework来完成。<br>相比硬件加速渲染和聚合执行Core Animaiton和OpenGL，software drawing真的很慢。<br>除了速度上的慢,software drawing还需要很多内存。 CALayerDelegate -drawLayer:inContext:会造成离屏渲染。<br>除非必要，尽可能少的绘制。</p>
<h3 id="Vector-Graphics"><a href="#Vector-Graphics" class="headerlink" title="Vector Graphics"></a>Vector Graphics</h3><h3 id="Asynchronous-Drawing"><a href="#Asynchronous-Drawing" class="headerlink" title="Asynchronous Drawing"></a>Asynchronous Drawing</h3><p>UIKit单线程的性质意味着the backing images必须在主线程更新，这就表示绘制可能中断用户操作，让整个APP看起来卡住了。<br>解决方法时在其它线程提前绘制然后把相应的图片设置为layer的contents。CATiledLayer和drawsAsynchronously属性可以做这件事情。</p>
<h4 id="CATailedLayer"><a href="#CATailedLayer" class="headerlink" title="CATailedLayer"></a>CATailedLayer</h4><h4 id="drawsAsynchronously"><a href="#drawsAsynchronously" class="headerlink" title="drawsAsynchronously"></a>drawsAsynchronously</h4><h2 id="Image-IO"><a href="#Image-IO" class="headerlink" title="Image IO"></a>Image IO</h2><h3 id="Loading-and-Latency"><a href="#Loading-and-Latency" class="headerlink" title="Loading and Latency"></a>Loading and Latency</h3><p>iOS 看门狗，APP 20s之内还没有启动完成，会被干掉。</p>
<h3 id="Thread-Loading"><a href="#Thread-Loading" class="headerlink" title="Thread Loading"></a>Thread Loading</h3><h3 id="GCD-and-NSOperationQueue"><a href="#GCD-and-NSOperationQueue" class="headerlink" title="GCD and NSOperationQueue"></a>GCD and NSOperationQueue</h3><h3 id="Deferred-Decompression"><a href="#Deferred-Decompression" class="headerlink" title="Deferred Decompression"></a>Deferred Decompression</h3><p>PNG文件比较大，加载慢，但是decompression比较快，尤其是Xcode using optimal settings for fast decoding 重新压缩了PNG,JPEG 文件较小加载更快但是decopression更慢。因为JPEG的decopression算法比PNG基于zip的算法更复杂。<br>+imageNamed:此方法加载图片之后立即解压缩，其它的图片加载方法都会推迟解压缩。+imageNamed:只对application resources bundle内的图片起作用。<br>另一个直接解压缩图片的方法是把图片赋值给layer的contens属性或者UIImageView的image的属性。但是这些操作必须在主线程中进行。<br>第三种方式是使用ImageIO framework, 代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSInteger index = indexPath.row;</span><br><span class="line">NSURL *imageURL = [NSURL fileURLWithPath:self.imagePaths[index]]; NSDictionary *options = @&#123;(__bridge id)kCGImageSourceShouldCache: @YES&#125;; CGImageSourceRef source = CGImageSourceCreateWithURL(</span><br><span class="line">(__bridge CFURLRef)imageURL, NULL);</span><br><span class="line">CGImageRef imageRef = CGImageSourceCreateImageAtIndex(source, 0,</span><br><span class="line">(__bridge CFDictionaryRef)options);</span><br><span class="line">UIImage *image = [UIImage imageWithCGImage:imageRef]; CGImageRelease(imageRef);</span><br><span class="line">CFRelease(source);</span><br></pre></td></tr></table></figure></p>
<p>创建图片的时候使用kCGImageSourceShouldCache选项，这会强制解压缩图片并在image的生命周期内retain解压缩之后的图片。<br>第四种方式使用UIKit加载图片，然后立即把它绘制到CGContext中。图片在绘制之前必须被解压缩，所以此举会强制解压缩开始。这么做的优势在于绘制可以在后台线程中进行，因此不会阻塞UI。</p>
<h3 id="CATailedLayer-1"><a href="#CATailedLayer-1" class="headerlink" title="CATailedLayer"></a>CATailedLayer</h3><h3 id="Caching"><a href="#Caching" class="headerlink" title="Caching"></a>Caching</h3><h4 id="The-imageNamed-Method"><a href="#The-imageNamed-Method" class="headerlink" title="The +imageNamed: Method"></a>The +imageNamed: Method</h4><h3 id="Custom-Caching"><a href="#Custom-Caching" class="headerlink" title="Custom Caching"></a>Custom Caching</h3><h4 id="NSCache"><a href="#NSCache" class="headerlink" title="NSCache"></a>NSCache</h4><h4 id="Hybrid-Images"><a href="#Hybrid-Images" class="headerlink" title="Hybrid Images"></a>Hybrid Images</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//load color image</span><br><span class="line">UIImage *image = [UIImage imageNamed:@&quot;Snowman.jpg&quot;];</span><br><span class="line"></span><br><span class="line">//load mask image</span><br><span class="line">UIImage *mask = [UIImage imageNamed:@&quot;SnowmanMask.png&quot;];</span><br><span class="line"></span><br><span class="line">//convert mask to correct format</span><br><span class="line">CGColorSpaceRef graySpace = CGColorSpaceCreateDeviceGray();</span><br><span class="line">CGImageRef maskRef = CGImageCreateCopyWithColorSpace(mask.CGImage, graySpace);</span><br><span class="line">CGColorSpaceRelease(graySpace);</span><br><span class="line"></span><br><span class="line">//combine images</span><br><span class="line">CGImageRef resultRef = CGImageCreateWithMask(image.CGImage, maskRef);</span><br><span class="line">UIImage *result = [UIImage imageWithCGImage:resultRef];</span><br><span class="line">CGImageRelease(resultRef);</span><br><span class="line">CGImageRelease(maskRef);</span><br><span class="line"></span><br><span class="line">//display result</span><br><span class="line">self.imageView.image = result;</span><br></pre></td></tr></table></figure>
<h4 id="JPEG2000"><a href="#JPEG2000" class="headerlink" title="JPEG2000"></a>JPEG2000</h4><p>JPEG2000比相同大小JPEG图片拥有更好的质量，同时还提供透明度支持。但是JPEG2000的加载和展示速度比PNG和JPEG要慢。如果对App瘦身有较高的要求可以考虑JPEG2000。</p>
<h4 id="PVRTC"><a href="#PVRTC" class="headerlink" title="PVRTC"></a>PVRTC</h4><h2 id="Layer-Performance"><a href="#Layer-Performance" class="headerlink" title="Layer Performance"></a>Layer Performance</h2><h3 id="Inexplicit-Drawing"><a href="#Inexplicit-Drawing" class="headerlink" title="Inexplicit Drawing"></a>Inexplicit Drawing</h3><p>The layer backing image可以显示的被创建，也可以隐形的被创建。<br>明白什么时候为什么会发生隐式创建可以避免不必要的绘制。</p>
<h4 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h4><p>CATextLayer和UILabel都是使用软件绘制，比较慢。包含文本的view的frame发生变化时，会造成文本重绘。要尽可能避免这一点。比如，如果要展示一个频繁变化size的角落里包含一段文本的layer，把text放到sublayer更合适。</p>
<h4 id="Rasterization"><a href="#Rasterization" class="headerlink" title="Rasterization"></a>Rasterization</h4><p>启用shouldRasterize属性会使得layer被绘制成离屛图片。这个图片会被缓存并替换实际layer的contents和sublayers。<br>Rasterizing用的合适了就能改善性能，但是要避免Rasterizing layers whose content changes every frame，这会使caching的benefit无效，性能更糟糕。<br>To test whether you are using rasterization appropriately, use the Color Hits Green and Misses Red instrument to see if the rasterized image cache is being frequently flushed。</p>
<h4 id="Offscreen-Rendering"><a href="#Offscreen-Rendering" class="headerlink" title="Offscreen Rendering"></a>Offscreen Rendering</h4><p>The layer attributes that trigger offscreen rendering are as follows:</p>
<ul>
<li>Rounded Corners (when combined with maskToBounds)</li>
<li>layer masks</li>
<li>Drop shadows<br>Offscreen rendering的影响和和enbale rasterization时很相似，除了开销没有rasterization a layer那么大，the sublayers are not affected, and the result is not cached, 所以没有长期的内存影响。<br>有太多离屛渲染的layers时候会对性能造成显著影响，但是可以启用rasterization来利用有利方面的影响（缓存），这种情况适用于不需要频繁重绘的layer。<br>对于需要离屛渲染的layer或者需要动画（或者有sublayer需要动画），可以使用CAShapeLayer，contentsCenter或者shadowPath去利用更少性能方面的影响区实现相似的表现。<h4 id="CAShapeLayer-1"><a href="#CAShapeLayer-1" class="headerlink" title="CAShapeLayer"></a>CAShapeLayer</h4>分别使用cornerRadius或者masksToBounds不会造成性能方面的影响，but when combind, they trigger offscreen rendering. 使用CAShapeLayer和+bezierPathWithRoundedRect:cornerRadius:可以避免离屏渲染。</li>
</ul>
<h4 id="Stretchable-Images"><a href="#Stretchable-Images" class="headerlink" title="Stretchable Images"></a>Stretchable Images</h4><p>contentsCenter</p>
<h4 id="shadowPath"><a href="#shadowPath" class="headerlink" title="shadowPath"></a>shadowPath</h4><h3 id="Blending-and-Overdraw"><a href="#Blending-and-Overdraw" class="headerlink" title="Blending and Overdraw"></a>Blending and Overdraw</h3><p>混合图层或者忽略图层处理起来都很麻烦，可以尽可能的利用下面两点来优化性能：</p>
<ul>
<li>Set the backgroundColor of your view to a fixed, opaque color.  </li>
<li>Set the opaque property of the view to YES.</li>
</ul>
<h3 id="Reducing-Layer-Count"><a href="#Reducing-Layer-Count" class="headerlink" title="Reducing Layer Count"></a>Reducing Layer Count</h3>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#CALayer的一些重要属性"><span class="toc-number">1.</span> <span class="toc-text">CALayer的一些重要属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layer-Geometry"><span class="toc-number">2.</span> <span class="toc-text">Layer Geometry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Visual-Effects"><span class="toc-number">3.</span> <span class="toc-text">Visual Effects</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Rounded-Corners"><span class="toc-number">3.1.</span> <span class="toc-text">Rounded Corners</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Layer-Borders"><span class="toc-number">3.2.</span> <span class="toc-text">Layer Borders</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Drop-Shadows"><span class="toc-number">3.3.</span> <span class="toc-text">Drop Shadows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Shadow-Clipping"><span class="toc-number">3.4.</span> <span class="toc-text">Shadow Clipping</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layer-Masking"><span class="toc-number">4.</span> <span class="toc-text">Layer Masking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scaling-Filters"><span class="toc-number">5.</span> <span class="toc-text">Scaling Filters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Group-Opacity"><span class="toc-number">6.</span> <span class="toc-text">Group Opacity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transforms"><span class="toc-number">7.</span> <span class="toc-text">Transforms</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Affine-Transforms"><span class="toc-number">7.1.</span> <span class="toc-text">Affine Transforms</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Shear-Transform"><span class="toc-number">7.2.</span> <span class="toc-text">The Shear Transform</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3D-Transforms"><span class="toc-number">8.</span> <span class="toc-text">3D Transforms</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Vanishing-Point"><span class="toc-number">8.1.</span> <span class="toc-text">The Vanishing Point</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-sublayerTransform-Property"><span class="toc-number">8.2.</span> <span class="toc-text">The sublayerTransform Property</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layer-Flattening"><span class="toc-number">9.</span> <span class="toc-text">Layer Flattening</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solid-Objects"><span class="toc-number">10.</span> <span class="toc-text">Solid Objects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Light-and-Shadow"><span class="toc-number">11.</span> <span class="toc-text">Light and Shadow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Specialized-Layers"><span class="toc-number">12.</span> <span class="toc-text">Specialized Layers</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CAShapeLayer"><span class="toc-number">12.1.</span> <span class="toc-text">CAShapeLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#除了使用CAShapeLayer绘制圆角，UIBezierPath提供了分别控制矩形圆角大小的能力"><span class="toc-number">12.2.</span> <span class="toc-text">除了使用CAShapeLayer绘制圆角，UIBezierPath提供了分别控制矩形圆角大小的能力</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CATextLayer"><span class="toc-number">12.3.</span> <span class="toc-text">CATextLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CATransformLayer"><span class="toc-number">12.4.</span> <span class="toc-text">CATransformLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAGradientLayer"><span class="toc-number">12.5.</span> <span class="toc-text">CAGradientLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAReplicatorLayer"><span class="toc-number">12.6.</span> <span class="toc-text">CAReplicatorLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAScrollLayer"><span class="toc-number">12.7.</span> <span class="toc-text">CAScrollLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CATiledLayer"><span class="toc-number">12.8.</span> <span class="toc-text">CATiledLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAEmitterLayer"><span class="toc-number">12.9.</span> <span class="toc-text">CAEmitterLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAEAGLLayer"><span class="toc-number">12.10.</span> <span class="toc-text">CAEAGLLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AVPlayerLayer-属于AVfoundation-不属于Core-Animation"><span class="toc-number">12.11.</span> <span class="toc-text">AVPlayerLayer  属于AVfoundation,不属于Core Animation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implict-Animations"><span class="toc-number">13.</span> <span class="toc-text">Implict Animations</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Transactions"><span class="toc-number">13.1.</span> <span class="toc-text">Transactions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Completion-Block"><span class="toc-number">13.2.</span> <span class="toc-text">Completion Block</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Layer-Actions"><span class="toc-number">13.3.</span> <span class="toc-text">Layer Actions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Presentation-Versus-Model"><span class="toc-number">13.4.</span> <span class="toc-text">Presentation Versus Model</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Explict-Animations"><span class="toc-number">14.</span> <span class="toc-text">Explict Animations</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Property-Animations"><span class="toc-number">14.1.</span> <span class="toc-text">Property Animations</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Basic-Animations"><span class="toc-number">14.1.1.</span> <span class="toc-text">Basic Animations</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CAAmimationDelegate"><span class="toc-number">14.1.2.</span> <span class="toc-text">CAAmimationDelegate</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyframe-Animations"><span class="toc-number">14.2.</span> <span class="toc-text">Keyframe Animations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Virtual-Properties"><span class="toc-number">14.3.</span> <span class="toc-text">Virtual Properties</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Animation-Groups"><span class="toc-number">15.</span> <span class="toc-text">Animation Groups</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transitions"><span class="toc-number">16.</span> <span class="toc-text">Transitions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Implicit-Transitions"><span class="toc-number">16.1.</span> <span class="toc-text">Implicit Transitions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Animating-Layer-Tree-Changes"><span class="toc-number">16.2.</span> <span class="toc-text">Animating Layer Tree Changes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Custom-Transitions"><span class="toc-number">16.3.</span> <span class="toc-text">Custom Transitions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Canceling-an-Animation-in-Progress"><span class="toc-number">17.</span> <span class="toc-text">Canceling an Animation in Progress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layer-Time"><span class="toc-number">18.</span> <span class="toc-text">Layer Time</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-CAMediaTiming-Protocol"><span class="toc-number">18.1.</span> <span class="toc-text">The CAMediaTiming Protocol</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Duartion-and-Repetition"><span class="toc-number">18.2.</span> <span class="toc-text">Duartion and Repetition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Relative-Time"><span class="toc-number">18.3.</span> <span class="toc-text">Relative Time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fillMode"><span class="toc-number">18.4.</span> <span class="toc-text">fillMode</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hierarchical-Time"><span class="toc-number">19.</span> <span class="toc-text">Hierarchical Time</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Global-Versus-Local-Time"><span class="toc-number">19.1.</span> <span class="toc-text">Global Versus Local Time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pause-Rewind-and-Fast-Forward"><span class="toc-number">19.2.</span> <span class="toc-text">Pause, Rewind, and Fast-Forward</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Manual-Animation"><span class="toc-number">20.</span> <span class="toc-text">Manual Animation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Easing"><span class="toc-number"></span> <span class="toc-text">Easing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Animation-Velocity"><span class="toc-number">1.</span> <span class="toc-text">Animation Velocity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CAMediaTimingFunction"><span class="toc-number">2.</span> <span class="toc-text">CAMediaTimingFunction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Easing-and-KeyFrame-Animations"><span class="toc-number">3.</span> <span class="toc-text">Easing and KeyFrame Animations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Easing-Functions"><span class="toc-number">4.</span> <span class="toc-text">Custom Easing Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyframe-Based-Easing"><span class="toc-number">4.1.</span> <span class="toc-text">Keyframe-Based Easing</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Timer-Based-Animation"><span class="toc-number">5.</span> <span class="toc-text">Timer-Based Animation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Frame-Timeing"><span class="toc-number">5.1.</span> <span class="toc-text">Frame Timeing</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#NSTimer"><span class="toc-number">5.1.1.</span> <span class="toc-text">NSTimer</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CADisplayLink"><span class="toc-number">5.2.</span> <span class="toc-text">CADisplayLink</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mesauring-Frame-Duration"><span class="toc-number">5.3.</span> <span class="toc-text">Mesauring Frame Duration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Run-Loop-Modes"><span class="toc-number">5.4.</span> <span class="toc-text">Run Loop Modes</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Physical-Simulation"><span class="toc-number">6.</span> <span class="toc-text">Physical Simulation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Chipmunk"><span class="toc-number">6.1.</span> <span class="toc-text">Chipmunk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GPU-Bound-Opearions"><span class="toc-number">6.2.</span> <span class="toc-text">GPU-Bound Opearions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CPU-Bound-Operations"><span class="toc-number">6.3.</span> <span class="toc-text">CPU-Bound Operations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IO-Bound-Operations"><span class="toc-number">6.4.</span> <span class="toc-text">IO-Bound Operations</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Measure，Don’t-Guess"><span class="toc-number">7.</span> <span class="toc-text">Measure，Don’t Guess</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-Reality-Not-a-Simulation"><span class="toc-number">7.1.</span> <span class="toc-text">Test Reality, Not a Simulation</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Efficent-Drawing"><span class="toc-number"></span> <span class="toc-text">Efficent Drawing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Software-Drawing"><span class="toc-number">1.</span> <span class="toc-text">Software Drawing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vector-Graphics"><span class="toc-number">2.</span> <span class="toc-text">Vector Graphics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Asynchronous-Drawing"><span class="toc-number">3.</span> <span class="toc-text">Asynchronous Drawing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CATailedLayer"><span class="toc-number">3.1.</span> <span class="toc-text">CATailedLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#drawsAsynchronously"><span class="toc-number">3.2.</span> <span class="toc-text">drawsAsynchronously</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Image-IO"><span class="toc-number"></span> <span class="toc-text">Image IO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Loading-and-Latency"><span class="toc-number">1.</span> <span class="toc-text">Loading and Latency</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thread-Loading"><span class="toc-number">2.</span> <span class="toc-text">Thread Loading</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GCD-and-NSOperationQueue"><span class="toc-number">3.</span> <span class="toc-text">GCD and NSOperationQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deferred-Decompression"><span class="toc-number">4.</span> <span class="toc-text">Deferred Decompression</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CATailedLayer-1"><span class="toc-number">5.</span> <span class="toc-text">CATailedLayer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Caching"><span class="toc-number">6.</span> <span class="toc-text">Caching</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-imageNamed-Method"><span class="toc-number">6.1.</span> <span class="toc-text">The +imageNamed: Method</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Caching"><span class="toc-number">7.</span> <span class="toc-text">Custom Caching</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NSCache"><span class="toc-number">7.1.</span> <span class="toc-text">NSCache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hybrid-Images"><span class="toc-number">7.2.</span> <span class="toc-text">Hybrid Images</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JPEG2000"><span class="toc-number">7.3.</span> <span class="toc-text">JPEG2000</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PVRTC"><span class="toc-number">7.4.</span> <span class="toc-text">PVRTC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Layer-Performance"><span class="toc-number"></span> <span class="toc-text">Layer Performance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Inexplicit-Drawing"><span class="toc-number">1.</span> <span class="toc-text">Inexplicit Drawing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Text"><span class="toc-number">1.1.</span> <span class="toc-text">Text</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Rasterization"><span class="toc-number">1.2.</span> <span class="toc-text">Rasterization</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Offscreen-Rendering"><span class="toc-number">1.3.</span> <span class="toc-text">Offscreen Rendering</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAShapeLayer-1"><span class="toc-number">1.4.</span> <span class="toc-text">CAShapeLayer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stretchable-Images"><span class="toc-number">1.5.</span> <span class="toc-text">Stretchable Images</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shadowPath"><span class="toc-number">1.6.</span> <span class="toc-text">shadowPath</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blending-and-Overdraw"><span class="toc-number">2.</span> <span class="toc-text">Blending and Overdraw</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reducing-Layer-Count"><span class="toc-number">3.</span> <span class="toc-text">Reducing Layer Count</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/03/29/iOS-Core-Animation/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&text=iOS Core Animation"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&is_video=false&description=iOS Core Animation"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=iOS Core Animation&body=Check out this article: http://yoursite.com/2017/03/29/iOS-Core-Animation/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&title=iOS Core Animation"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/03/29/iOS-Core-Animation/&name=iOS Core Animation&description=&lt;h3 id=&quot;CALayer的一些重要属性&quot;&gt;&lt;a href=&quot;#CALayer的一些重要属性&quot; class=&quot;headerlink&quot; title=&quot;CALayer的一些重要属性&quot;&gt;&lt;/a&gt;CALayer的一些重要属性&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;contents&lt;/li&gt;
&lt;li&gt;contestGravity (UView-contentMode)&lt;/li&gt;
&lt;li&gt;contentsScale&lt;/li&gt;
&lt;li&gt;masksToBounds (UIView-clipsToBounds)&lt;/li&gt;
&lt;li&gt;contentsRect (The default contentsRect is {0, 0, 1, 1}, 代表整个backing image是可见的)，如果设置成{0, 0, 0.5, 0.5}，就变成左上角四分之一是可见的。（与CSS中的雪碧图概念类似），我们可以把一张图片设置成contents,然后再修改contentsRect属性，达到只使用一部分图片的效果。&lt;/li&gt;
&lt;li&gt;contentsCenter这个名字乍看上去具有误导性，它的默认值是{0, 0, 1, 1},这代表我们缩放图片的时候，整个图片的区域都会被缩放，如果我们修改contentCenter的值，就可以达到修改缩放区域的目的。聊天类的应用中该属性应该比较常用，比如聊天气泡。&lt;/li&gt;&lt;/ul&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2017/03/29/iOS-Core-Animation/&t=iOS Core Animation"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2020
    于木木
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-89789260-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?237cd7bbe979bebea6c6c345088eb8fb";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


</body>
</html>
